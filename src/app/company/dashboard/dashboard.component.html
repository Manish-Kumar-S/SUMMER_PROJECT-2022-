<div class="company-container">

  <!-- <div fxFlex="1%"></div> -->

  <h1>Dashboard</h1>
  <br *ngIf="isTabView || isMobileView">

  <div>
    <mat-accordion class="example-headers-align" multi>
      <mat-spinner [fxShow]="isLoading" [fxHide]="!isLoading" style="margin: auto;margin-bottom: 100px;" [diameter]="70"></mat-spinner>
      <!-- <mat-expansion-panel [fxHide]="isLoading">
        <mat-expansion-panel-header style="height: 100px;">
          <mat-panel-title fxFlex="100%">
            <div fxLayout="column" fxLayoutGap="10px" fxFlex>
              <h3 fxFlex="100%"> Pienzatech Campus Drive Anna University</h3>
              <div fxLayout="row">
                <div fxLayout="row" fxFlex>
                  <div fxLayout="column" fxFlex="30%">
                    <p> Role: </p>
                    <p> Applied On: </p>
                  </div>
                  <div fxLayout="column" fxFlex="70%">
                    <i>SDE</i>
                    <i>19/01/2021</i>
                  </div>
                </div>
                <div fxLayout="row" fxFlex>
                  <div fxLayout="column" fxFlex="50%">
                    <p> Online test Schedule </p>
                    <p> Interview Schedule: </p>
                  </div>
                  <div fxLayout="column" fxFlex="50%">
                    <i>19/01/2021</i>
                    <i>19/01/2021</i>
                  </div>
                </div>
                <div fxLayout="row" fxFlex>
                  <div fxLayout="column" fxFlex="50%">
                    <p> Eligible Departments </p>
                    <p> CGPA Criteria </p>
                  </div>
                  <div fxLayout="column" fxFlex="50%">
                    <i>CSE, IT, MECH, AUTO...</i>
                    <i>7.5+</i>
                  </div>
                </div>
              </div>
              <p fxFlex> Role: <i> SDE </i>  </p>
              <p fxFlex="10%"> Applied On: <i> 19/01/2021 </i> </p>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div fxFlex="100%">
          <div fxLayout="column" fxLayoutGap="5px">

            <div fxLayout="column">
              <div fxLayoutAlign="end">
                <button mat-raised-button color="primary" style="margin: 2px">View Registered Students</button>
                <button mat-raised-button color="success" style="margin: 2px">Download <mat-icon>download</mat-icon></button>
              </div>
              <br>
              <mat-divider></mat-divider>
            </div>

            <mat-form-field appearance="fill">
              <mat-label>First name</mat-label>
              <input matInput>
            </mat-form-field>
        
            <mat-form-field appearance="fill">
              <mat-label>Age</mat-label>
              <input matInput type="number" min="1">
            </mat-form-field>
          </div>
          
        </div>
    
      </mat-expansion-panel> -->

      <p *ngIf="driveResponse?.length === 0">Seems like you haven't Created a Drive. Please Create one <a routerLink="../campus-drive">here</a></p>
    
      <mat-expansion-panel *ngFor="let drive of driveResponse">
        <mat-expansion-panel-header [style]="isTabView ? 'height:150px' : isMobileView ? 'height: 250px' : 'height: 100px;'">
          <mat-panel-title fxFlex="100%">
            <div fxLayout="column" fxLayoutGap="10px" fxFlex>
              <h3 fxFlex="100%">  {{drive.drive_name}} <!-- <a mat-raised-button color="success">Registration</a> --> </h3>
              <div [fxLayout]="isTabView || isMobileView ? 'column' : 'row'">
                <div fxLayout="row" fxFlex>
                  <div fxLayout="column" fxFlex="50%">
                    <p> Role: </p>
                    <p> Posted On: </p>
                  </div>
                  <div fxLayout="column" fxFlex="50%">
                    <i>{{drive.roles}}</i>
                    <i>{{drive.posted_date.split('T')[0]}}</i>
                  </div>
                </div>
                <div fxLayout="row" fxFlex>
                  <div fxLayout="column" fxFlex="50%">
                    <p> Online test Schedule </p>
                    <p> Interview Schedule: </p>
                  </div>
                  <div fxLayout="column" fxFlex="50%">
                    <i>{{drive.date_time_of_test.split('T')[0]}} {{drive.date_time_of_test.split('T')[1].split(':')[0]}}:{{drive.date_time_of_test.split('T')[1].split(':')[1]}}</i>
                    <i>{{drive.date_time_of_interview[0].split('T')[0]}} {{drive.date_time_of_interview[0].split('T')[1].split(':')[0]}}:{{drive.date_time_of_interview[0].split('T')[1].split(':')[1]}}</i>
                  </div>
                </div>
                <div fxLayout="row" fxFlex>
                  <div fxLayout="column" fxFlex="50%">
                    <p> Eligible Departments </p>
                    <p> CGPA Criteria </p>
                  </div>
                  <div fxLayout="column" fxFlex="50%">
                    <div style="overflow:hidden;white-space:nowrap;text-overflow: ellipsis;" fxFlex="99%">
                      <i *ngFor="let course of drive.eligible_courses">{{course.code}} </i>
                    </div>
                    <i>{{drive.eligibility_in_present}}</i>
                  </div>
                </div>
              </div>
              <!-- <p fxFlex> Role: <i> SDE </i>  </p>
              <p fxFlex="10%"> Applied On: <i> 19/01/2021 </i> </p> -->
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div fxFlex="100%">
          <br>
          <div fxLayout="column" fxLayoutGap="5px">

            <div fxLayout="column">
              <div fxLayoutAlign="end">
                <button mat-raised-button color="primary" style="margin: 2px" (click)="getStudentDetails(drive.id, tableView)">View Registered Students</button>
                <button mat-raised-button color="success" style="margin: 2px">Download <mat-icon>download</mat-icon></button>
              </div>
              <br>
              <mat-divider></mat-divider>
            </div>

            <app-drive-update [driveResponse]="drive"></app-drive-update>

          </div>
          
        </div>
    
      </mat-expansion-panel>

    </mat-accordion>
  </div>

  <mat-divider></mat-divider>

  <div #tableView [fxHide]="!show">
    
    <mat-table [dataSource]="dataSource" class="mat-elevation-z8" fxFlex="100%">
      <!--- Note that these columns can be defined in any order.
            The actual rendered columns are set as a property on the row definition" -->
    
      <ng-container matColumnDef="reg_no">
        <mat-header-cell *matHeaderCellDef> Reg No </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.reg_number}} </mat-cell>
      </ng-container>
    
      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.first_name + " " + element.last_name}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="gender">
        <mat-header-cell *matHeaderCellDef> Gender </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.gender}} </mat-cell>
      </ng-container>
    
      <ng-container matColumnDef="email">
        <mat-header-cell *matHeaderCellDef> E-Mail </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.email}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="phone">
        <mat-header-cell *matHeaderCellDef> Mobile </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.phone}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="grade_x">
        <mat-header-cell *matHeaderCellDef fxFlex="8%"> Grade X </mat-header-cell>
        <mat-cell *matCellDef="let element" fxFlex="8%"> {{element.grade_10_percentage}} </mat-cell>
      </ng-container>
    
      <ng-container matColumnDef="grade_xii">
        <mat-header-cell *matHeaderCellDef fxFlex="8%"> Grade XII </mat-header-cell>
        <mat-cell *matCellDef="let element" fxFlex="8%"> {{element.grade_12_percentage}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="history_of_arrears">
        <mat-header-cell *matHeaderCellDef fxFlex="8%"> History of Arrears </mat-header-cell>
        <mat-cell *matCellDef="let element" fxFlex="8%"> {{element.history_of_arrears ? "Yes":"No"}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="backlogs">
        <mat-header-cell *matHeaderCellDef fxFlex="5%"> Backlogs </mat-header-cell>
        <mat-cell *matCellDef="let element" fxFlex="5%"> {{element.number_of_arrears}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="cgpa">
        <mat-header-cell *matHeaderCellDef fxFlex="5%"> CGPA </mat-header-cell>
        <mat-cell *matCellDef="let element" fxFlex="5%"> {{element.ug_course_percentage}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="resume">
        <mat-header-cell *matHeaderCellDef fxFlex="5%"> Resume Link </mat-header-cell>
        <mat-cell *matCellDef="let element" fxFlex="5%"> 
          <button mat-icon-button color="primary" (click)="openNewTab(element.resume_link)">
            <mat-icon class="mat-18">insert_link</mat-icon>
          </button> 
        </mat-cell>
      </ng-container>
    
      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>

  </div>

</div>
<div fxLayout="column" fxFlexOffSet="40px"></div>
